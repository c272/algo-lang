// Functions for the to-do app in Algo.
// by Larry Tang, 2019

//Import required libraries.
import "core";
import "io";

///////////////////////
// UTILITY FUNCTIONS //
///////////////////////

//Open the to-do notes file.
let getNotes() =
{
    //Get file text.
    let todoText = input.fromFile("todo.txt");

    //Split by line.
    let todoItems = string.split(todoText, "\n");
    let parsedItems = [];

    //For each of the items, convert them to item info.
    for (i in todoItems) 
    {
        let item = todoItems[i];

        //Don't read a blank item.
        if (item == "") { continue; }

        //Not blank, so parse it and add!
        item = string.split(item, "|");
        item = object {
            let id = int(item[0]);
            let text = item[1];
        };
        
        add item to parsedItems;
    }

    return parsedItems;
}

//Get information about a to-do with a given ID.
let getByID(x) =
{
    //Get file.
    let todoItems = getNotes();
    
    //Loop over items.
    foreach (item in todoItems) 
    {
        if (item.id == x) { return item; }
    }

    //Didn't find it :(
    return null;
}

//Create a new note in the to-do notes file.
let createItem(x) =
{
    let todoText = input.fromFile("todo.txt");
    let todoItems = getNotes();
    
    //Get maximum used ID.
    let maxID = 0;
    foreach (item in todoItems)
    {
        if (item.id > maxID)
        {
            maxID = item.id;
        }
    }

    //Add to todo text.
    todoText += "\n" + maxID + "|" + x;

    //Save todo file.
    output.toFile("todo.txt", todoText);
}